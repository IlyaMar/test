# порт для метрик UA меняем с дефолтного 16300 на 16302, дефолтный занят другим UA на svm
monitoring:
  port: 16302

# порт для статуса UA меняем с дефолтного 16301 на 16303, дефолтный занят другим UA на svm
status:
  port: 16303

import:
  - /configs/*.yaml
    iam-clickhouse.yaml":"routes:
  - input:
      plugin: file_input
      id: file_input-iam-oslogin-service_clickhouse_access_log
      config:
        path: /varlog/access.log
        state_directory: /varlib/data/oslogin-service_cloudlogging_access_log_input_state
        max_bytes_in_line: 10mb

    channel:
      pipe:
        - filter:
            plugin: batch
            id: batch-iam-oslogin-service_clickhouse_access_log
            config:
              delimiter: \"\
\"
              flush_period: 1s
              limit:
                count: 40000
                bytes: 20mb
      output:
        plugin: clickhouse
        id: clickhouse-iam-oslogin-service_clickhouse_access_log
        config:
          hosts:
            - rc1a-d66et9iifm66p7ej.mdb.cloud-preprod.yandex.net
          port: 9440
          use_ssl: true
          user: logs
          password_file: /varsecrets/clickhouse_secret.txt
          database: logs
          table: access_log
","iam-cloudlogging.yaml":"routes:
  - input:
      plugin: file_input
      id: file_input-iam-oslogin-service_cloudlogging_server_log
      config:
        path: /varlog/server_json.log
        state_directory: /varlib/data/oslogin-service_cloudlogging_server_log_input_state
        max_bytes_in_line: 10mb

    channel:
      output:
        plugin: yc_logs
        id: yc_logs-iam-oslogin-service_cloudlogging_server_log
        config:
          url: ingester.logging.cloud-preprod.yandex.net:443
          folder_id: yc.iam.logs-folder
          log_group_id: preprod.yc-iam.server-log
          iam:
            cloud_meta:
              url: \"http://localhost:6770/computeMetadata/v1/instance/service-accounts/default/token\"
          use_ssl: { }
          parse_json:
            payload:
              keys: [\"message\"]
            timestamp:
              keys: [\"instant\"]
            priority:
              keys: [\"level\"]
          resource_id: !expr \"{$host_name}\"
          resource_type: oslogin-service_cloudlogging
","iam-dpl-events.yaml":"routes:
  - input:
      plugin: file_input
      id: file_input-iam-oslogin-service_dpl_events_dpl_events_log
      config:
        path: /varlog/dpl-events.log
        state_directory: /varlib/data/oslogin-service_dpl_events_dpl_log_input_state
        max_bytes_in_line: 10mb

    channel:
      pipe:
        - filter:
            plugin: batch
            id: batch-iam-oslogin-service_dpl_events_dpl_events_log
            config:
              delimiter: \"\
\"
              flush_period: 1s
              limit:
                count: 300
                bytes: 8mb
      output:
        plugin: logbroker
        id: logbroker-iam-oslogin-service_dpl_events_dpl_events_log
        config:
          endpoint: lb.audit-trails-input-events-topics-db.ydb.mdb.cloud-preprod.yandex.net
          port: 2135
          database: /pre-prod_global/audit-trails-input-events-topics-db
          topic: topics/data-plane/iam
          codec: gzip
          use_ydb_discovery: true
          use_ssl: {}
          iam:
            cloud_meta:
              url: \"http://localhost:6770/computeMetadata/v1/instance/service-accounts/default/token\"
","iam-events.yaml":"routes:
  - input:
      plugin: file_input
      id: file_input-iam-oslogin-service_events_events_log
      config:
        path: /varlog/events.log
        state_directory: /varlib/data/oslogin-service_events_log_input_state
        max_bytes_in_line: 10mb

    channel:
      pipe:
        - filter:
            plugin: batch
            id: batch-iam-oslogin-service_events_events_log
            config:
              delimiter: \"\
\"
              flush_period: 1s
              limit:
                count: 300
                bytes: 8mb
      output:
        plugin: logbroker
        id: logbroker-iam-oslogin-service_events_events_log
        config:
          endpoint: lb.audit-trails-input-events-topics-db.ydb.mdb.cloud-preprod.yandex.net
          port: 2135
          database: /pre-prod_global/audit-trails-input-events-topics-db
          topic: topics/control-plane/common
          codec: gzip
          use_ydb_discovery: true
          use_ssl: {}
          iam:
            cloud_meta:
              url: \"http://localhost:6770/computeMetadata/v1/instance/service-accounts/default/token\"
","iam-logbroker.yaml":"routes:
  - input:
      plugin: file_input
      id: file_input-iam-oslogin-service_logbroker_access_log
      config:
        path: /varlog/access.log
        state_directory: /varlib/data/oslogin-service_logbroker_access_log_input_state
        max_bytes_in_line: 10mb

    channel:
      pipe:
        - filter:
            plugin: batch
            id: batch-iam-oslogin-service_logbroker_access_log
            config:
              delimiter: \"\
\"
              flush_period: 1s
              limit:
                count: 1000
                bytes: 8mb
      output:
        plugin: logbroker
        id: logbroker-iam-oslogin-service_logbroker_access_log
        config:
          endpoint: lb.iam-logbroker-global.ydb.mdb.cloud-preprod.yandex.net 
          port: 2135
          database: /pre-prod_global/yc.iam.service-cloud/cc80dv2sjgaitdeut590
          topic: yc-iam-access-log
          codec: gzip
          use_ydb_discovery: true
          use_ssl: {}
          iam:
            cloud_meta:
              url: \"http://localhost:6770/computeMetadata/v1/instance/service-accounts/default/token\"

  - input:
      plugin: file_input
      id: file_input-iam-oslogin-service_logbroker_server_log
      config:
        path: /varlog/server_json.log
        state_directory: /varlib/data/oslogin-service_logbroker_server_log_input_state
        max_bytes_in_line: 10mb

    channel:
      output:
        plugin: logbroker
        id: logbroker-iam-oslogin-service_logbroker_server_log
        config:
          endpoint: lb.iam-logbroker-global.ydb.mdb.cloud-preprod.yandex.net
          port: 2135
          database: /pre-prod_global/yc.iam.service-cloud/cc80dv2sjgaitdeut590
          topic: yc-iam-server-log
          codec: gzip
          use_ydb_discovery: true
          use_ssl: {}
          iam:
            cloud_meta:
              url: \"http://localhost:6770/computeMetadata/v1/instance/service-accounts/default/token\"
","iam-traces.yaml":"routes:
  - input:
      plugin: otel_traces
      id: otel_traces-iam_traces_input
      config:
        protocol: grpc
        uri: localhost:4317

    channel:
      output:
        plugin: otel_traces
        id: otel_traces-iam_traces_output
        config:
          url: collector.tracing.cloud-preprod.yandex.net:4317
          project: yc.iam.service-cloud
          cluster: yc.iam.logs-folder
          service: iam-oslogin-service
          iam:
            cloud_meta:
              url: \"http://localhost:6770/computeMetadata/v1/instance/service-accounts/default/token\"
