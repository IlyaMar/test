export YCP_PROFILE=prod
export YC_PROFILE=$YCP_PROFILE
export YC_IAM_TOKEN=
export YC_IAM_TOKEN=$(ycp --profile ${YCP_PROFILE?} iam iam-token create-for-subject --subject-id yc.iam.service-account)
export YC_TOKEN=${YC_IAM_TOKEN?}


export YCP_PROFILE=preprod
export YC_PROFILE=$YCP_PROFILE
export YC_IAM_TOKEN=
export YC_IAM_TOKEN=$(ycp --profile ${YCP_PROFILE?} iam iam-token create-for-subject --subject-id yc.iam.service-account)
export YC_TOKEN=${YC_IAM_TOKEN?}
export KUBECONFIG=~/cloudia-terraform/cloud/iam/terraform/mk8s/preprod/.kubeconfig_iam-preprod



integral(series_sum(non_negative_derivative({'cluster'='preprod-iam-token-service', 'host'='iam-*', 'project'='yc.iam.service-cloud', 'service'='iam-token-service',sensor="grpc_statuses|servlet_statuses",app="*_server",method="iam.v1.IamTokenService/Create",status="OK|UNAUTHENTICATED|CANCELLED|NOT_FOUND|PERMISSION_DENIED|INVALID_ARGUMENT|4*|2*|3*"}))) / integral(series_sum(non_negative_derivative({'cluster'='preprod-iam-token-service', 'host'='iam-*', 'project'='yc.iam.service-cloud', 'service'='iam-token-service',sensor="grpc_statuses|servlet_statuses",app="*_server",method="iam.v1.IamTokenService/Create"}))) / (1 + integral(series_sum(non_negative_derivative({'cluster'='preprod-iam-token-service', 'host'='iam-*', 'project'='yc.iam.service-cloud', 'service'='iam-token-service',sensor="grpc_discarded_requests"}))) / integral(series_sum(non_negative_derivative({'cluster'='preprod-iam-token-service', 'host'='iam-*', 'project'='yc.iam.service-cloud', 'service'='iam-token-service',app="*_server",sensor="grpc_statuses|servlet_statuses"}))) )

kubectl exec -c ua app-ru-central1-a-0-5d9bbd46b4-7k8cb -- curl -v https://ingester.logging.cloud.yandex.net:8443


https://monitoring.yandex.cloud/projects/yc.iam.service-cloud/dashboards/fbe19hr86nois7rke10a/view
?p%5Bcluster%5D=prod-iam-token-service
&p%5Bservice%5D=iam-token-service
&p%5Bmethod%5D%5B0%5D=iam.v1.IamTokenService%2FCreateForServiceAccount
&p%5Bhost%5D%5B1%5D=iam-ts-klg1
&p%5Bapp%5D=token-service_server
&refresh=off&to=now&from=now-1w

GroupService.WriteOperations
0.250	0.916	0.545	12.000	0.333
OrganizationService.List
0.250	1.000	0.568	12.500	0.333
OrganizationService.Get
0.250	1.000	0.568	12.500	0.333
OrganizationService.BatchGet
0.250	1.000	0.568	12.500	0.333
GroupService.ListMembers
0.250	1.000	0.568	12.500	0.333
GroupService.List
0.250	1.000	0.568	12.500	0.333
GroupService.Get
0.250	1.000	0.568	12.500	0.333
FederationService.ListByOrganization
0.250	1.000	0.568	12.500	0.333
FederationService.Get
0.250	1.000	0.568	12.500	0.333
FederationService.AddUserAccountsCaseSensitive
0.166	0.916	0.530	11.666	0.250
CertificateService.List
0.250	1.000	0.568	12.500	0.333
CertificateService.Get
0.250	1.000	0.568	12.500	0.333
GroupService.AuthorizationRevokeMembership
0.174	1.000	0.560	12.333	0.333
GroupService.UpdateMembers
0.166	1.000	0.556	12.250	0.666
CertificateService.WriteOperations
0.250	1.000	0.590	13.000	0.833
FederationService.AddUserAccountsCaseInsensitive
0.166	1.000	0.553	12.166	0.666
GroupService.AuthorizationRevokeRole
0.181	1.000	0.564	12.416	1.000
FederationService.WriteOperations
0.166	1.000	0.579	12.750	1.000
